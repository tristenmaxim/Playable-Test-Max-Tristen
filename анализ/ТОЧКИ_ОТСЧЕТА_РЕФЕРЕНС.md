# Точки отсчета из референса (script_00_module.js)

## Референсные размеры экрана

### Фиксированные значения (из функции `Jl()`)
```javascript
// Референс использует фиксированные значения, а не динамические window.innerWidth/innerHeight
Me = 1280   // Высота экрана (фиксированное значение)
yt = 720    // Ширина экрана в портретной ориентации (единица расстояния)
es = 1280   // Ширина экрана в альбомной ориентации
```

**ВАЖНО:** Референс использует фиксированные значения размеров экрана (`Me=1280`, `yt=720`), а не динамические `window.innerWidth/innerHeight` для расчета масштабов и позиций.

---

## Константы игрока (объект `oe`)

```javascript
oe = {
  X_POSITION: 0.18,        // Позиция X = $e * 0.18 (18% от ширины экрана)
  GROUND_Y: 280,            // Y координата земли (от верха экрана)
  JUMP_HEIGHT: 300,         // Максимальная высота прыжка в пикселях
  JUMP_DURATION: 800,       // Длительность прыжка в миллисекундах
  INVINCIBILITY_TIME: 500,  // Время неуязвимости после урона
  SCALE: 0.54,              // МАСШТАБ ИГРОКА (фиксированное значение!)
  ANIMATION_SPEED: 0.15     // Скорость анимации
}
```

**КРИТИЧЕСКИ ВАЖНО:**
- `oe.SCALE = 0.54` - это **фиксированный масштаб** спрайта игрока, НЕ пропорциональный!
- В референсе: `this.sprite.scale.set(oe.SCALE)` - используется напрямую без пропорций
- `oe.X_POSITION = 0.18` - позиция игрока по X (18% от ширины экрана), а не 40%!

---

## Константы масштабов и смещений (объект `Te`)

```javascript
Te = {
  PLAYER_SCALE: {
    X: 0.25,   // Масштаб игрока по X (25% от размера спрайта) - для хитбокса!
    Y: 0.7     // Масштаб игрока по Y (70% от размера спрайта) - для хитбокса!
  },
  PLAYER_OFFSET: {
    X: 0,      // Смещение игрока по X
    Y: -0.15   // Смещение игрока по Y (относительное, отрицательное = вверх)
  },
  ENEMY_SCALE: {
    X: 0.3,
    Y: 0.5
  },
  ENEMY_OFFSET: {
    X: 0,
    Y: 0.2
  },
  OBSTACLE_SHRINK: 10,
  OBSTACLE_OFFSET: { X: 0, Y: 0 },
  COLLECTIBLE_RADIUS: 60  // Радиус коллектбла в пикселях
}
```

**ВАЖНО:** 
- `Te.PLAYER_SCALE` используется **только для расчета хитбокса** (`getHitbox()`), а НЕ для визуального масштабирования спрайта!
- Визуальный масштаб спрайта игрока задается через `oe.SCALE = 0.54`

---

## Расчет roadY (позиция дороги/земли)

```javascript
// В референсе:
roadY = Me - oe.GROUND_Y
roadY = 1280 - 280 = 1000

// Это означает, что дорога находится на Y = 1000 (от верха экрана)
// Или на высоте: window.innerHeight - 280 (если Me = window.innerHeight)
```

**roadY** - это позиция земли, где стоят кусты и деревья (низ экрана минус отступ).

---

## Позиционирование игрока

### Референс:
```javascript
// Позиция по X:
playerX = $e * oe.X_POSITION
playerX = window.innerWidth * 0.18  // 18% от ширины экрана!

// Позиция по Y:
playerY = roadY  // = 1000 (от верха экрана)

// Масштаб спрайта:
sprite.scale.set(oe.SCALE)  // SCALE = 0.54 (фиксированное значение!)

// Anchor:
sprite.anchor.set(0.5, 1)  // Центр по X, низ по Y
```

### Текущая реализация (НЕПРАВИЛЬНО):
```javascript
// Player.js использует:
this.x = window.innerWidth * 0.4  // ❌ Должно быть 0.18!

// Масштаб вычисляется пропорционально:
const scale = targetHeight / spriteHeight  // ❌ Должно быть фиксированное 0.54!
this.sprite.scale.set(scale, scale)
```

---

## Масштабирование фона

### Референс:
```javascript
// bgScale вычисляется как:
const scaleX = $e / bgTexture.width        // window.innerWidth / bgTexture.width
const scaleY = Me / bgTexture.height       // 1280 / bgTexture.height (фиксированное Me!)
bgScale = Math.max(scaleX, scaleY)         // Берется максимальный масштаб
```

**ВАЖНО:** В референсе используется фиксированное значение `Me=1280` для расчета `scaleY`, а не `window.innerHeight`!

### Текущая реализация (НЕПРАВИЛЬНО):
```javascript
// ParallaxBackground.js использует:
const referenceHeight = CONSTANTS.POSITIONS.REFERENCE_SCREEN_HEIGHT // 1280
const referenceScaleY = referenceHeight / textureHeight
const referenceBgScale = Math.max(referenceScaleX, referenceScaleY)

// Затем масштабирует пропорционально:
const heightScale = screenHeight / referenceHeight
this.bgScale = referenceBgScale * heightScale  // ❌ Это может быть неправильно!
```

---

## Единица расстояния для спавна (yt)

```javascript
// В референсе:
yt = 720  // Фиксированное значение (ширина экрана в портретной ориентации)

// Используется для расчета расстояний между коллектблами:
distanceInPixels = distance * yt  // где distance из spawnData

// Пример:
// distance: 1 = 720px
// distance: 2 = 1440px
// distance: 4.2 = 3024px
```

**ВАЖНО:** Референс использует фиксированное значение `yt=720` для единицы расстояния, а не динамическое `window.innerWidth`!

---

## Позиционирование коллектблов

### Референс:
```javascript
// Позиция X коллектбла при спавне:
spawnX = yt + yt * 0.5  // = 720 + 360 = 1080px (справа за экраном)
// ИЛИ в коде может использоваться:
spawnX = window.innerWidth + yt * 0.5  // = window.innerWidth + 360

// Позиция Y коллектбла:
baseY = roadY - 60  // = 1000 - 60 = 940 (базовая позиция на земле)
y = baseY - yOffset  // Коллектбл на yOffset=280 будет на Y=940-280=660

// Примеры:
// yOffset = 0   -> y = 940 (на земле)
// yOffset = 280 -> y = 940 - 280 = 660 (высоко в воздухе)
```

### Текущая реализация:
Нужно проверить, как именно вычисляются позиции коллектблов в `GameController.js` и `Collectible.js`.

---

## Высота прыжка

```javascript
// Максимальная высота прыжка:
JUMP_HEIGHT = 300px

// Это означает, что игрок может прыгнуть на 300px вверх от GROUND_Y
// Максимальная Y позиция игрока при прыжке:
maxJumpY = roadY - JUMP_HEIGHT = 1000 - 300 = 700 (от верха экрана)
```

---

## Ключевые соотношения

### Референсные значения:
1. **Экран (portrait):**
   - Ширина: 720px (yt)
   - Высота: 1280px (Me, es)

2. **Земля:**
   - GROUND_Y: 280px от верха экрана
   - roadY: 1000px от верха экрана (1280 - 280)

3. **Игрок:**
   - X позиция: 18% от ширины (yt * 0.18 = 129.6px)
   - Y позиция: roadY = 1000px
   - Масштаб: **фиксированный 0.54** (НЕ пропорциональный!)

4. **Расстояния:**
   - Единица расстояния: yt = 720px (фиксированное значение)
   - Коллектблы спавнятся на расстояниях: distance * 720px

5. **Прыжок:**
   - Максимальная высота: 300px от roadY
   - Может достичь коллектблов на высоте до 300px от базовой позиции

---

## Проблемы в текущей реализации

### Проблема #1: Масштаб игрока
- **Референс:** Фиксированный масштаб `0.54`
- **Текущая реализация:** Пропорциональный масштаб относительно высоты экрана
- **Результат:** Игрок выглядит слишком большим или слишком маленьким относительно фона

### Проблема #2: Позиция X игрока
- **Референс:** `window.innerWidth * 0.18` (18%)
- **Текущая реализация:** `window.innerWidth * 0.4` (40%)
- **Результат:** Игрок находится не в том месте по горизонтали

### Проблема #3: bgScale
- **Референс:** Использует фиксированное `Me=1280` для расчета `scaleY`
- **Текущая реализация:** Масштабирует пропорционально высоте экрана
- **Результат:** Фон может масштабироваться неправильно

### Проблема #4: Единица расстояния
- **Референс:** Использует фиксированное `yt=720` для единицы расстояния
- **Текущая реализация:** Возможно использует `window.innerWidth`
- **Результат:** Расстояния между коллектблами могут не совпадать

---

## Рекомендации для исправления

1. **Использовать фиксированный масштаб игрока `0.54`** вместо пропорционального
2. **Исправить позицию X игрока** с `0.4` на `0.18`
3. **Проверить масштабирование фона** - должно использовать фиксированное `Me=1280` для расчета `scaleY`
4. **Использовать фиксированное значение `yt=720`** для единицы расстояния при спавне коллектблов
5. **Масштабировать только позиции** (roadY, позиции коллектблов) пропорционально высоте экрана, но использовать фиксированные значения для масштабов

---

## Формулы из референса (для справки)

### Позиция игрока по X:
```javascript
playerX = window.innerWidth * 0.18
```

### Позиция игрока по Y:
```javascript
playerY = roadY  // где roadY = Me - oe.GROUND_Y = 1280 - 280 = 1000
```

### roadY:
```javascript
roadY = Me - oe.GROUND_Y  // = 1280 - 280 = 1000
// Для адаптации к разным размерам экрана:
roadY = (Me - oe.GROUND_Y) * (window.innerHeight / Me)
roadY = 1000 * (window.innerHeight / 1280)
```

### Масштаб спрайта игрока:
```javascript
sprite.scale.set(0.54)  // Фиксированное значение!
```

### Хитбокс игрока:
```javascript
hitboxWidth = spriteBounds.width * 0.25   // Te.PLAYER_SCALE.X
hitboxHeight = spriteBounds.height * 0.7  // Te.PLAYER_SCALE.Y
```

### Расстояние для спавна коллектблов:
```javascript
distanceInPixels = distance * 720  // где distance из spawnData, yt = 720
```

### Позиция Y коллектбла:
```javascript
baseY = roadY - 60  // = 1000 - 60 = 940
y = baseY - yOffset  // где yOffset из spawnData
```
