# Поэтапный план реализации с контролем

## Философия

Каждый этап должен быть **полностью функциональным и тестируемым** перед переходом к следующему. Это позволяет:
- Видеть прогресс на каждом шаге
- Тестировать компоненты изолированно
- Легко находить и исправлять баги
- Иметь работающую версию на любом этапе

---

## Этапы реализации

### Этап 0: Базовая инфраструктура ✅
**Цель**: Работающий canvas с PixiJS

**Задачи:**
- [x] HTML структура
- [x] Инициализация PixiJS
- [x] Базовые константы
- [x] Система загрузки ассетов (заглушка)
- [x] GameController (базовая структура)
- [x] Игровой цикл (ticker)

**Результат**: Чёрный экран с canvas, готовый к добавлению элементов

**Тест**: Открыть в браузере, увидеть canvas, проверить консоль на ошибки

---

### Этап 1: Фон (ParallaxBackground)
**Цель**: Статичный фон с параллакс эффектом

**Задачи:**
- [ ] Создать класс ParallaxBackground
- [ ] Загрузить текстуру фона (можно placeholder)
- [ ] Создать тайловый фон (6 тайлов)
- [ ] Реализовать бесшовную прокрутку
- [ ] Добавить базовый параллакс эффект
- [ ] Интегрировать в GameController

**Результат**: Фон прокручивается при движении игры

**Тест**: 
- Фон отображается
- Фон прокручивается при изменении `currentSpeed`
- Бесшовная прокрутка работает

**Критерии готовности:**
- ✅ Фон виден на экране
- ✅ Фон движется плавно
- ✅ Нет разрывов при прокрутке

---

### Этап 2: Игрок (Player) - Статичный
**Цель**: Игрок отображается на экране

**Задачи:**
- [ ] Создать класс Player
- [ ] Загрузить текстуру игрока (можно placeholder)
- [ ] Создать спрайт игрока
- [ ] Позиционировать игрока на земле
- [ ] Добавить в GameController
- [ ] Отобразить на экране

**Результат**: Игрок стоит на фоне

**Тест**:
- Игрок виден на экране
- Игрок стоит на правильной позиции (GROUND_Y)
- Игрок не двигается

**Критерии готовности:**
- ✅ Игрок отображается
- ✅ Позиция корректная
- ✅ Размеры корректные

---

### Этап 3: Игрок - Анимация бега
**Цель**: Игрок анимирован и бежит

**Задачи:**
- [ ] Загрузить spritesheet игрока (или создать кадры)
- [ ] Создать AnimatedSprite с анимацией бега
- [ ] Настроить скорость анимации
- [ ] Добавить метод `run()`
- [ ] Запустить анимацию при старте игры

**Результат**: Игрок бежит на месте

**Тест**:
- Анимация бега работает
- Скорость анимации приемлемая
- Переключение между анимациями работает

**Критерии готовности:**
- ✅ Анимация бега плавная
- ✅ Анимация зациклена
- ✅ Скорость анимации настроена

---

### Этап 4: Игрок - Прыжок
**Цель**: Игрок может прыгать

**Задачи:**
- [ ] Добавить физику прыжка (velocityY, gravity)
- [ ] Реализовать метод `jump()`
- [ ] Обновлять позицию Y в `update()`
- [ ] Проверка приземления
- [ ] Добавить обработку ввода (пока просто по клику)
- [ ] Добавить анимацию прыжка (опционально)

**Результат**: Игрок прыгает при клике

**Тест**:
- Клик → игрок прыгает
- Игрок поднимается и падает
- Игрок приземляется на землю
- Можно прыгать несколько раз подряд

**Критерии готовности:**
- ✅ Прыжок работает
- ✅ Физика реалистичная
- ✅ Приземление корректное

---

### Этап 5: Игрок - Интеграция с GameController
**Цель**: Игрок реагирует на состояния игры

**Задачи:**
- [ ] Игрок idle в состоянии INTRO
- [ ] Игрок бежит в состоянии RUNNING
- [ ] Игрок может прыгать только в RUNNING
- [ ] Игрок idle при паузе
- [ ] Обработка ввода через GameController.handleTap()

**Результат**: Игрок корректно реагирует на все состояния

**Тест**:
- INTRO → игрок idle
- Клик → RUNNING → игрок бежит
- Клик в RUNNING → прыжок
- PAUSED → игрок idle

**Критерии готовности:**
- ✅ Все состояния обрабатываются
- ✅ Переходы плавные
- ✅ Нет багов с состояниями

---

### Этап 6: Монетки (Collectibles) - Статичные
**Цель**: Монетки отображаются на экране

**Задачи:**
- [ ] Создать класс Collectible
- [ ] Загрузить текстуру монетки (можно placeholder)
- [ ] Создать спрайт монетки
- [ ] Позиционировать монетку
- [ ] Добавить в GameController
- [ ] Отобразить несколько монеток

**Результат**: Монетки видны на экране

**Тест**:
- Монетки отображаются
- Позиции корректные
- Размеры корректные

**Критерии готовности:**
- ✅ Монетки видны
- ✅ Позиции правильные

---

### Этап 7: Монетки - Движение и сбор
**Цель**: Монетки движутся и собираются

**Задачи:**
- [ ] Монетки движутся влево с игровой скоростью
- [ ] Реализовать анимацию вращения
- [ ] Добавить проверку коллизии с игроком
- [ ] При коллизии → удалить монетку
- [ ] Добавить визуальный эффект сбора (опционально)

**Результат**: Монетки движутся и собираются при касании

**Тест**:
- Монетки движутся влево
- Коллизия работает
- Монетка исчезает при сборе
- Можно собрать несколько монеток

**Критерии готовности:**
- ✅ Движение плавное
- ✅ Коллизия точная
- ✅ Сбор работает

---

### Этап 8: Система счёта
**Цель**: Счёт увеличивается при сборе монеток

**Задачи:**
- [ ] Добавить отображение счёта (пока в консоль)
- [ ] При сборе монетки → увеличить счёт
- [ ] Разные типы монеток дают разный счёт
- [ ] Обновление счёта в GameController

**Результат**: Счёт отображается и обновляется

**Тест**:
- Сбор монетки → счёт увеличивается
- Разные монетки дают разный счёт
- Счёт отображается корректно

**Критерии готовности:**
- ✅ Счёт обновляется
- ✅ Значения корректные

---

### Этап 9: Враги (Enemies)
**Цель**: Враги появляются и движутся

**Задачи:**
- [ ] Создать класс Enemy
- [ ] Загрузить текстуру/анимацию врага
- [ ] Враги движутся влево
- [ ] Добавить систему спавна (пока фиксированные позиции)
- [ ] Враги удаляются при выходе за экран

**Результат**: Враги появляются и движутся

**Тест**:
- Враги отображаются
- Враги движутся
- Враги удаляются за экраном

**Критерии готовности:**
- ✅ Враги видны
- ✅ Движение корректное
- ✅ Удаление работает

---

### Этап 10: Коллизии с врагами
**Цель**: Столкновение с врагом наносит урон

**Задачи:**
- [ ] Проверка коллизии игрок-враг
- [ ] При коллизии → уменьшить HP
- [ ] Добавить неуязвимость после урона
- [ ] Анимация получения урона
- [ ] Проверка смерти (HP = 0)

**Результат**: Столкновение с врагом наносит урон

**Тест**:
- Столкновение → урон
- Неуязвимость работает
- Смерть при HP = 0

**Критерии готовности:**
- ✅ Коллизия точная
- ✅ Урон наносится
- ✅ Неуязвимость работает

---

### Этап 11: Препятствия (Obstacles)
**Цель**: Препятствия появляются и наносят урон

**Задачи:**
- [ ] Создать класс Obstacle
- [ ] Загрузить текстуры препятствий
- [ ] Препятствия движутся влево
- [ ] Коллизия с препятствиями
- [ ] Урон при столкновении

**Результат**: Препятствия работают как враги

**Тест**: Аналогично врагам

**Критерии готовности:**
- ✅ Препятствия работают
- ✅ Коллизия работает

---

### Этап 12: Система спавна
**Цель**: Сущности спавнятся по данным

**Задачи:**
- [ ] Создать массив данных спавна
- [ ] Реализовать checkSpawns() в GameController
- [ ] Спавн по пройденному расстоянию
- [ ] Разные типы сущностей спавнятся корректно

**Результат**: Сущности появляются автоматически

**Тест**:
- Сущности спавнятся в правильное время
- Порядок спавна правильный
- Позиции корректные

**Критерии готовности:**
- ✅ Спавн работает
- ✅ Порядок правильный

---

### Этап 13: Финишная линия
**Цель**: Финишная линия появляется и завершает игру

**Задачи:**
- [ ] Создать класс FinishLine
- [ ] Загрузить текстуру финиша
- [ ] Финиш спавнится в конце уровня
- [ ] При достижении → замедление
- [ ] Анимация разрыва ленты
- [ ] Переход в состояние END_WIN

**Результат**: Игра завершается при достижении финиша

**Тест**:
- Финиш появляется
- Замедление работает
- Победа срабатывает

**Критерии готовности:**
- ✅ Финиш работает
- ✅ Завершение корректное

---

### Этап 14: UI - HP Display
**Цель**: Отображение здоровья игрока

**Задачи:**
- [ ] Создать HP Display элемент
- [ ] Отобразить сердечки/полоску здоровья
- [ ] Обновление при изменении HP
- [ ] Анимация при изменении

**Результат**: HP отображается на экране

**Тест**:
- HP видно
- Обновление работает
- Анимация плавная

**Критерии готовности:**
- ✅ HP отображается
- ✅ Обновление работает

---

### Этап 15: UI - Score Display
**Цель**: Отображение счёта

**Задачи:**
- [ ] Создать Score Display элемент
- [ ] Отобразить текущий счёт
- [ ] Обновление при изменении счёта
- [ ] Анимация при изменении

**Результат**: Счёт отображается на экране

**Тест**: Аналогично HP Display

**Критерии готовности:**
- ✅ Счёт отображается
- ✅ Обновление работает

---

### Этап 16: UI - Tutorial Overlay
**Цель**: Обучающий оверлей

**Задачи:**
- [ ] Создать Tutorial Overlay
- [ ] Показ при первом запуске
- [ ] Показ при приближении врага
- [ ] Скрытие после клика

**Результат**: Туториал показывается в нужные моменты

**Тест**:
- Туториал показывается
- Скрытие работает
- Текст читаемый

**Критерии готовности:**
- ✅ Туториал работает
- ✅ Тайминг правильный

---

### Этап 17: UI - End Screens
**Цель**: Экраны победы и поражения

**Задачи:**
- [ ] Создать End Overlay (победа)
- [ ] Создать Fail Overlay (поражение)
- [ ] Показ при завершении игры
- [ ] Отображение финального счёта
- [ ] CTA кнопка

**Результат**: Экраны завершения работают

**Тест**:
- Экраны показываются
- Счёт отображается
- Кнопки работают

**Критерии готовности:**
- ✅ Экраны работают
- ✅ Дизайн приятный

---

### Этап 18: Аудио система
**Цель**: Звуки и музыка

**Задачи:**
- [ ] Интегрировать Howler.js
- [ ] Загрузить звуковые эффекты
- [ ] Звук прыжка
- [ ] Звук сбора монетки
- [ ] Звук урона
- [ ] Звук победы/поражения
- [ ] Фоновая музыка

**Результат**: Все звуки работают

**Тест**:
- Звуки воспроизводятся
- Громкость приемлемая
- Нет задержек

**Критерии готовности:**
- ✅ Звуки работают
- ✅ Качество хорошее

---

### Этап 19: Конфетти и эффекты
**Цель**: Визуальные эффекты

**Задачи:**
- [ ] Создать ConfettiEmitter
- [ ] Конфетти при победе
- [ ] Эффекты при сборе монеток
- [ ] Другие визуальные эффекты

**Результат**: Эффекты работают

**Тест**: Эффекты отображаются корректно

**Критерии готовности:**
- ✅ Эффекты работают
- ✅ Производительность хорошая

---

### Этап 20: Полировка
**Цель**: Финальная оптимизация

**Задачи:**
- [ ] Оптимизация размера
- [ ] Оптимизация производительности
- [ ] Responsive design
- [ ] Исправление багов
- [ ] Тестирование

**Результат**: Готовая игра

---

## Порядок реализации (рекомендуемый)

```
Этап 0: Базовая инфраструктура ✅
  ↓
Этап 1: Фон
  ↓
Этап 2: Игрок (статичный)
  ↓
Этап 3: Игрок (анимация бега)
  ↓
Этап 4: Игрок (прыжок)
  ↓
Этап 5: Игрок (интеграция)
  ↓
Этап 6: Монетки (статичные)
  ↓
Этап 7: Монетки (движение и сбор)
  ↓
Этап 8: Система счёта
  ↓
Этап 9: Враги
  ↓
Этап 10: Коллизии с врагами
  ↓
Этап 11: Препятствия
  ↓
Этап 12: Система спавна
  ↓
Этап 13: Финишная линия
  ↓
Этап 14: UI - HP Display
  ↓
Этап 15: UI - Score Display
  ↓
Этап 16: UI - Tutorial
  ↓
Этап 17: UI - End Screens
  ↓
Этап 18: Аудио
  ↓
Этап 19: Эффекты
  ↓
Этап 20: Полировка
```

---

## Контрольные точки

После каждого этапа:
1. ✅ Код коммитится в Git
2. ✅ Игра запускается без ошибок
3. ✅ Новый функционал работает
4. ✅ Нет регрессий в старом функционале
5. ✅ Консоль чистая (нет ошибок)

---

## Примечания

- Каждый этап должен быть **независимым** и **тестируемым**
- Можно использовать **placeholder'ы** для ассетов на ранних этапах
- **Не переходить** к следующему этапу пока текущий не работает идеально
- **Документировать** сложные решения
- **Тестировать** на разных устройствах на каждом этапе
