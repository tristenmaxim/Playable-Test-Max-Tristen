# План работы с ассетами

## Обзор

Детальный план по работе с ассетами: извлечение, оптимизация, конвертация в data URI и интеграция в игру.

---

## Этапы работы с ассетами

### Этап 1: Извлечение ассетов из референса

#### Задача 1.1: Извлечение изображений
- [ ] Извлечь все изображения из HTML (data URI)
- [ ] Декодировать base64 в файлы
- [ ] Сохранить в папку `assets/images/`
- [ ] Сохранить метаданные (размер, формат)

**Инструменты:**
- Скрипт для извлечения data URI из HTML
- Base64 декодер

#### Задача 1.2: Извлечение аудио
- [ ] Извлечь все аудио файлы из HTML
- [ ] Декодировать base64 в файлы
- [ ] Сохранить в папку `assets/audio/`
- [ ] Определить назначение каждого файла

#### Задача 1.3: Извлечение шрифтов
- [ ] Извлечь шрифты из HTML
- [ ] Сохранить в папку `assets/fonts/`
- [ ] Проверить лицензию шрифта

#### Задача 1.4: Извлечение spritesheets
- [ ] Найти JSON описания spritesheet
- [ ] Извлечь изображения spritesheet
- [ ] Сохранить JSON и изображения
- [ ] Проверить структуру JSON

---

### Этап 2: Анализ и каталогизация

#### Задача 2.1: Каталогизация изображений
Создать таблицу всех изображений:

| Файл | Размер | Формат | Назначение | Приоритет |
|------|--------|--------|------------|-----------|
| asset_0004.png | 242 KB | PNG | Фон | Высокий |
| asset_0005.png | 438 KB | PNG | Фон | Высокий |
| asset_0015.png | 147 KB | PNG | Spritesheet врагов | Высокий |
| ... | ... | ... | ... | ... |

#### Задача 2.2: Определение использования
- [ ] Сопоставить ассеты с их использованием в коде
- [ ] Определить критичные ассеты (загружаются первыми)
- [ ] Определить опциональные ассеты
- [ ] Найти неиспользуемые ассеты

#### Задача 2.3: Анализ spritesheets
- [ ] Парсить JSON описания
- [ ] Извлечь координаты кадров
- [ ] Определить анимации
- [ ] Создать документацию по spritesheet

---

### Этап 3: Оптимизация

#### Задача 3.1: Оптимизация изображений

**Стратегия:**
1. **Большие изображения (> 100 KB)**:
   - Конвертировать в WebP
   - Оптимизировать качество (80-90%)
   - Проверить визуальное качество

2. **Средние изображения (10-100 KB)**:
   - Конвертировать в WebP
   - Оптимизировать качество (85-95%)

3. **Маленькие изображения (< 10 KB)**:
   - Оставить PNG для прозрачности
   - Или конвертировать в AVIF для лучшего сжатия

4. **Spritesheets**:
   - Оптимизировать размер
   - Удалить неиспользуемые кадры
   - Оптимизировать JSON

**Инструменты:**
- ImageOptim
- Squoosh
- TinyPNG
- Sharp (Node.js)

#### Задача 3.2: Оптимизация аудио

**Стратегия:**
1. **Фоновая музыка**:
   - Битрейт: 128 kbps
   - Формат: MP3
   - Длина: только нужные части

2. **Звуковые эффекты**:
   - Битрейт: 64-96 kbps
   - Формат: MP3
   - Обрезать тишину в начале/конце

**Инструменты:**
- Audacity
- FFmpeg
- Online audio compressors

#### Задача 3.3: Оптимизация шрифтов
- [ ] Подмножество шрифта (только нужные символы)
- [ ] Оптимизация формата (WOFF2 если возможно)
- [ ] Проверка размера

---

### Этап 4: Конвертация в data URI

#### Задача 4.1: Создание скрипта конвертации
```javascript
// convert-to-data-uri.js
const fs = require('fs')
const path = require('path')

function convertToDataURI(filePath) {
  const fileBuffer = fs.readFileSync(filePath)
  const base64 = fileBuffer.toString('base64')
  const mimeType = getMimeType(filePath)
  return `data:${mimeType};base64,${base64}`
}

function getMimeType(filePath) {
  const ext = path.extname(filePath).toLowerCase()
  const mimeTypes = {
    '.png': 'image/png',
    '.webp': 'image/webp',
    '.jpg': 'image/jpeg',
    '.mp3': 'audio/mpeg',
    '.wav': 'audio/wav',
    '.ttf': 'font/ttf'
  }
  return mimeTypes[ext] || 'application/octet-stream'
}
```

#### Задача 4.2: Создание объекта ASSETS
```javascript
const ASSETS = {
  images: {
    background: "data:image/webp;base64,...",
    player: "data:image/png;base64,...",
    // ...
  },
  spritesheets: {
    player: {
      json: "data:application/json;base64,...",
      image: "data:image/png;base64,..."
    },
    // ...
  },
  audio: {
    jump: "data:audio/mpeg;base64,...",
    collect: "data:audio/mpeg;base64,...",
    // ...
  },
  fonts: {
    main: "data:font/ttf;base64,..."
  }
}
```

#### Задача 4.3: Проверка размера
- [ ] Измерить размер каждого data URI
- [ ] Проверить общий размер
- [ ] Убедиться что < 5 MB

---

### Этап 5: Интеграция в игру

#### Задача 5.1: Загрузка ассетов
```javascript
class AssetLoader {
  async loadAll() {
    // Загрузка критичных ассетов
    await this.loadCritical()
    
    // Загрузка остальных ассетов
    await this.loadRemaining()
  }
  
  async loadCritical() {
    // Фон, игрок, базовые UI элементы
  }
  
  async loadRemaining() {
    // Остальные ассеты
  }
}
```

#### Задача 5.2: Кэширование
- [ ] Кэшировать загруженные текстуры
- [ ] Переиспользовать текстуры
- [ ] Очищать неиспользуемые текстуры

#### Задача 5.3: Обработка ошибок
- [ ] Fallback текстуры
- [ ] Обработка ошибок загрузки
- [ ] Показ прогресса загрузки

---

## Приоритеты ассетов

### Критичные (загружаются первыми)
1. Фон (ParallaxBackground)
2. Игрок (Player spritesheet)
3. Базовые UI элементы
4. Основные звуки (jump, collect)

### Важные (загружаются вторыми)
1. Враги (Enemy spritesheet)
2. Препятствия (Obstacle sprites)
3. Коллекции (Collectible sprites)
4. Звуки (hit, win, lose)

### Опциональные (загружаются последними)
1. Декорации фона
2. Конфетти текстуры
3. Фоновая музыка
4. Дополнительные UI элементы

---

## Оптимизация размера

### Целевые размеры

| Тип | Целевой размер | Максимальный размер |
|-----|----------------|---------------------|
| HTML + JS | < 2 MB | 2.5 MB |
| Изображения | < 2 MB | 2.5 MB |
| Аудио | < 1 MB | 1.5 MB |
| **Общий** | **< 5 MB** | **5 MB** |

### Стратегия оптимизации

1. **Если размер > 5 MB:**
   - Оптимизировать самые большие файлы
   - Удалить неиспользуемые ассеты
   - Уменьшить качество где возможно
   - Использовать более эффективные форматы

2. **Если размер < 4 MB:**
   - Можно улучшить качество некоторых ассетов
   - Добавить дополнительные эффекты

---

## Инструменты

### Извлечение
- Скрипт для парсинга HTML
- Base64 декодер
- File system utilities

### Оптимизация
- **Изображения**: ImageOptim, Squoosh, Sharp
- **Аудио**: Audacity, FFmpeg
- **Шрифты**: Font subsetting tools

### Конвертация
- Node.js скрипты
- Base64 encoder
- File system utilities

### Проверка
- Размер файлов
- Визуальное качество
- Функциональность в игре

---

## Чеклист

### Извлечение
- [ ] Все изображения извлечены
- [ ] Все аудио файлы извлечены
- [ ] Все шрифты извлечены
- [ ] Все spritesheets извлечены

### Оптимизация
- [ ] Изображения оптимизированы
- [ ] Аудио оптимизировано
- [ ] Шрифты оптимизированы
- [ ] Размеры соответствуют целям

### Интеграция
- [ ] Data URI созданы
- [ ] ASSETS объект создан
- [ ] Загрузка работает
- [ ] Кэширование работает

### Тестирование
- [ ] Все ассеты загружаются
- [ ] Качество приемлемое
- [ ] Размер < 5 MB
- [ ] Производительность хорошая

---

## Следующие шаги

1. Извлечь ассеты из референса
2. Оптимизировать ассеты
3. Конвертировать в data URI
4. Интегрировать в игру
5. Протестировать

---

## Примечания

- Сохранять оригиналы ассетов для возможных изменений
- Документировать все изменения
- Тестировать качество после оптимизации
- Проверять размер на каждом этапе
