# Аудио система

## Обзор

Игра использует Howler.js v2.2.4 для управления аудио. Библиотека встроена в основной JS файл и использует Web Audio API для лучшей производительности.

---

## Howler.js

### Версия
- **v2.2.4** - встроена в код (не через CDN)

### Особенности
- Поддержка Web Audio API
- Поддержка HTML5 Audio (fallback)
- Spatial Plugin для стерео и 3D аудио
- Автоматическое управление пулом аудио элементов
- Автоматическая разблокировка аудио (autoUnlock)

---

## Аудио файлы

### Структура

Все аудио файлы хранятся как data URI в основном HTML файле.

#### Звуковые эффекты (короткие)

1. **asset_0028.wav** (0.05 KB)
   - Формат: WAV
   - Размер: очень маленький
   - Предполагаемое использование: звук клика/тапа

2. **asset_0029.wav** (0.05 KB)
   - Формат: WAV
   - Размер: очень маленький
   - Предполагаемое использование: звук клика/тапа

3. **asset_0030.mp3** (1.85 KB)
   - Формат: MP3
   - Размер: небольшой
   - Предполагаемое использование: звук прыжка

4. **asset_0031.mp3** (1.14 KB)
   - Формат: MP3
   - Размер: небольшой
   - Предполагаемое использование: звук сбора коллекции

5. **asset_0032.mp3** (2.98 KB)
   - Формат: MP3
   - Размер: небольшой
   - Предполагаемое использование: звук получения урона

6. **asset_0033.mp3** (4.91 KB)
   - Формат: MP3
   - Размер: небольшой
   - Предполагаемое использование: звук победы

7. **asset_0034.mp3** (2.26 KB)
   - Формат: MP3
   - Размер: небольшой
   - Предполагаемое использование: звук поражения

#### Фоновая музыка (длинные)

8. **asset_0035.mp3** (39.68 KB)
   - Формат: MP3
   - Размер: средний
   - Предполагаемое использование: фоновая музыка (короткая)

9. **asset_0036.mp3** (29.42 KB)
   - Формат: MP3
   - Размер: средний
   - Предполагаемое использование: фоновая музыка (короткая)

10. **asset_0037.mp3** (351.99 KB)
    - Формат: MP3
    - Размер: большой
    - Предполагаемое использование: фоновая музыка (основная)

---

## Загрузка аудио

### Механизм

Аудио файлы загружаются через систему загрузки ассетов (`te.load()`):

```javascript
// Предполагаемая структура
const audioAssets = {
  jump: await te.load("data:audio/mpeg;base64,..."),      // asset_0030
  collect: await te.load("data:audio/mpeg;base64,..."),   // asset_0031
  hit: await te.load("data:audio/mpeg;base64,..."),       // asset_0032
  win: await te.load("data:audio/mpeg;base64,..."),       // asset_0033
  lose: await te.load("data:audio/mpeg;base64,..."),      // asset_0034
  bgm1: await te.load("data:audio/mpeg;base64,..."),      // asset_0035
  bgm2: await te.load("data:audio/mpeg;base64,..."),      // asset_0036
  bgm3: await te.load("data:audio/mpeg;base64,..."),      // asset_0037
  click: await te.load("data:audio/wav;base64,..."),      // asset_0028/0029
}
```

### Инициализация Howler

```javascript
// Howler автоматически инициализируется при первом использовании
const sound = new Howl({
  src: [audioDataUri],
  volume: 1.0,
  loop: false,  // для звуковых эффектов
  preload: true
})

// Для фоновой музыки
const bgm = new Howl({
  src: [bgmDataUri],
  volume: 0.5,
  loop: true,   // зацикливание
  preload: true
})
```

---

## Использование аудио

### Звуковые эффекты

#### Прыжок
```javascript
// При прыжке игрока
jumpSound.play()
```

#### Сбор коллекции
```javascript
// При сборе коллекции
collectSound.play()
```

#### Получение урона
```javascript
// При столкновении с врагом/препятствием
hitSound.play()
```

#### Победа
```javascript
// При достижении финиша
winSound.play()
```

#### Поражение
```javascript
// При потере всех HP
loseSound.play()
```

### Фоновая музыка

#### Запуск
```javascript
// При старте игры
bgm.play()
```

#### Остановка
```javascript
// При паузе или окончании игры
bgm.stop()
```

#### Пауза/Возобновление
```javascript
// При паузе
bgm.pause()

// При возобновлении
bgm.play()
```

---

## Управление громкостью

### Глобальная громкость

```javascript
// Установка громкости (0.0 - 1.0)
Howler.volume(0.7)

// Получение текущей громкости
const volume = Howler.volume()
```

### Громкость отдельных звуков

```javascript
// Установка громкости для конкретного звука
sound.volume(0.5)

// Громкость фоновой музыки обычно ниже
bgm.volume(0.3)
```

### Мут/Анмут

```javascript
// Мут всех звуков
Howler.mute(true)

// Анмут всех звуков
Howler.mute(false)

// Мут конкретного звука
sound.mute(true)
```

---

## Оптимизации

### 1. Пул аудио элементов

Howler.js автоматически управляет пулом HTML5 Audio элементов:
- `html5PoolSize: 10` - размер пула
- Переиспользование элементов для лучшей производительности

### 2. Web Audio API

Приоритетное использование Web Audio API:
- Лучшая производительность
- Низкая задержка
- Поддержка эффектов

### 3. Автоматическая разблокировка

```javascript
autoUnlock: true
```

Автоматическая разблокировка аудио после первого взаимодействия пользователя (требование браузеров).

### 4. Автоматическая приостановка

```javascript
autoSuspend: true
```

Автоматическая приостановка аудио контекста при неактивности для экономии ресурсов.

### 5. Предзагрузка

```javascript
preload: true
```

Предзагрузка аудио файлов для мгновенного воспроизведения.

---

## Spatial Plugin

### Стерео

```javascript
// Установка стерео режима
Howler.stereo(0.5)  // 0.0 - моно, 1.0 - стерео
```

### 3D позиционирование

```javascript
// Установка позиции слушателя
Howler.pos(x, y, z)

// Установка ориентации
Howler.orientation(x, y, z, upX, upY, upZ)
```

---

## Обработка ошибок

### Обработка загрузки

```javascript
const sound = new Howl({
  src: [audioDataUri],
  onload: () => {
    console.log("Audio loaded")
  },
  onloaderror: (id, error) => {
    console.error("Audio load error:", error)
  }
})
```

### Обработка воспроизведения

```javascript
sound.on('play', () => {
  console.log("Sound playing")
})

sound.on('end', () => {
  console.log("Sound ended")
})

sound.on('error', (id, error) => {
  console.error("Sound error:", error)
})
```

---

## Примечания

- Howler.js встроен в код (не через CDN)
- Все аудио файлы хранятся как data URI
- Используется Web Audio API для лучшей производительности
- Автоматическое управление пулом и разблокировкой
- Поддержка стерео и 3D аудио через Spatial Plugin
- Фоновая музыка зациклена, звуковые эффекты одноразовые
- Громкость фоновой музыки обычно ниже звуковых эффектов
