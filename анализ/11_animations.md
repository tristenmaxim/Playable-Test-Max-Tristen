# Система анимаций

## Обзор

Игра использует комбинацию PixiJS AnimatedSprite для спрайтовых анимаций и GSAP для UI анимаций.

---

## GSAP (GreenSock Animation Platform)

### Подключение

```html
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
```

### Использование

GSAP используется для анимации UI элементов:
- Появление/исчезновение оверлеев
- Анимация счёта
- Анимация летящих коллекций
- Анимация экрана победы/поражения

### Примеры

#### Анимация появления
```javascript
gsap.to(element, {
  opacity: 1,
  duration: 0.3,
  ease: "power2.out"
})
```

#### Анимация масштаба
```javascript
gsap.to(element, {
  scale: 1.1,
  duration: 0.2,
  yoyo: true,
  repeat: 1
})
```

---

## PixiJS AnimatedSprite

### Обзор

Используется для спрайтовых анимаций игровых объектов (игрок, враги, препятствия).

### Структура

#### Создание
```javascript
const frames = [
  texture1,
  texture2,
  texture3,
  // ...
]

const animatedSprite = new AnimatedSprite(frames)
animatedSprite.animationSpeed = 0.1  // Скорость анимации
animatedSprite.play()                 // Запуск
```

#### Свойства
- `animationSpeed` - скорость анимации (кадров в секунду)
- `loop` - зацикливание (по умолчанию true)
- `currentFrame` - текущий кадр
- `totalFrames` - общее количество кадров

### Методы

- `play()` - запуск анимации
- `stop()` - остановка анимации
- `gotoAndStop(frame)` - переход к кадру и остановка
- `gotoAndPlay(frame)` - переход к кадру и запуск

---

## Типы анимаций

### 1. Спрайтовые анимации (PixiJS)

#### Игрок
- **idle** - покой (циклическая)
- **run** - бег (циклическая)
- **jump** - прыжок (одноразовая)
- **hurt** - получение урона (одноразовая)

#### Враги
- **idle** - покой
- **run** - бег (циклическая)
- **attack** - атака (одноразовая)

#### Препятствия
- Статичные спрайты (без анимации)

#### Коллекции
- **idle** - покой (циклическая, вращение)
- **collect** - сбор (одноразовая)

### 2. UI анимации (GSAP)

#### Оверлеи
- Появление/исчезновение (fade in/out)
- Масштабирование (scale)

#### Счёт
- Пульсация при изменении
- Анимация летящих коллекций к счёту

#### Экран победы/поражения
- Появление элементов
- Анимация карточки PayPal
- Анимация конфетти

---

## Анимация летящих коллекций

### Механизм

При сборе коллекции создаётся летящий элемент, который движется к счёту.

#### Реализация
```javascript
animateFlyingCollectible(position, type) {
  // Создание элемента
  const element = document.createElement("div")
  element.className = "flying-collectible"
  
  // Позиционирование
  element.style.left = `${position.x}px`
  element.style.top = `${position.y}px`
  
  // Анимация через CSS
  element.style.animation = `fly-to-score 0.4s ease-in forwards`
  
  // Добавление в DOM
  document.body.appendChild(element)
  
  // Удаление после анимации
  element.addEventListener("animationend", () => {
    element.remove()
  })
}
```

#### CSS анимация
```css
@keyframes fly-to-score {
  from {
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  to {
    transform: translate(var(--target-x), var(--target-y)) scale(0.5);
    opacity: 0;
  }
}
```

---

## Анимация конфетти

### ConfettiEmitter (kq)

Класс для создания эффекта конфетти при победе.

#### Структура
- `particles` - массив частиц
- `textures` - текстуры для частиц (6 различных)
- `isActive` - флаг активности

#### Константы
- `PARTICLE_COUNT` - количество частиц (50)
- `LIFETIME` - время жизни частицы (5000ms)
- `FADE_START` - начало затухания (0.7)
- `BURST_SPEED_MIN` - минимальная скорость (12)
- `BURST_SPEED_MAX` - максимальная скорость (20)
- `GRAVITY` - гравитация (0.05)
- `AIR_RESISTANCE` - сопротивление воздуха (0.998)

#### Методы

##### `burst(x, y, angle = -90)`
Создаёт взрыв конфетти в точке:
- Создаёт `PARTICLE_COUNT` частиц
- Каждая частица имеет случайную скорость и направление
- Угол разброса: `angle ± BURST_ANGLE_SPREAD`

##### `burstFromSides(width, height)`
Создаёт конфетти с боков экрана:
- Левая сторона: угол -70°
- Правая сторона: угол -110°

##### `animate()`
Обновляет частицы каждый кадр:
- Применяет гравитацию
- Применяет сопротивление воздуха
- Обновляет позицию
- Обновляет вращение
- Удаляет частицы после истечения времени жизни

---

## Анимация предупреждающих меток

### Механизм

Метки предупреждений пульсируют для привлечения внимания.

#### Реализация
```javascript
updateWarningLabels(deltaMS) {
  const scale = 1 + Math.sin(Date.now() * 0.008) * 0.1
  label.container.scale.set(scale)
}
```

- Использует синусоиду для плавного пульсирования
- Масштаб изменяется от 0.9 до 1.1

---

## Оптимизации

### 1. Object Pooling

Переиспользование спрайтов для анимаций:
- Частицы конфетти переиспользуются
- Декоративные элементы переиспользуются

### 2. Условная анимация

Анимации обновляются только когда активны:
- Конфетти обновляется только при `isActive = true`
- Спрайтовые анимации останавливаются при паузе

### 3. CSS анимации для UI

Использование CSS анимаций вместо JS для UI элементов:
- Лучшая производительность
- Аппаратное ускорение

---

## Примечания

- GSAP используется только для UI анимаций
- PixiJS AnimatedSprite используется для игровых объектов
- Анимации оптимизированы через пулы и условное обновление
- CSS анимации используются для простых UI эффектов
- Конфетти использует физику для реалистичного движения
